name: Cleanup PR Images

on:
  pull_request:
    types: [closed]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      packages: write

    steps:
      - name: Delete PR preview images
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            console.log(`Cleaning up images for PR #${prNumber}`);
            
            // Note: GitHub doesn't have a direct API to delete package versions by tag
            // The images will be cleaned up by GitHub's retention policies
            // Or you can use the GitHub Container Registry API manually
            
            console.log(`PR #${prNumber} closed. Preview images tagged with pr-${prNumber} will be cleaned up by retention policy.`);